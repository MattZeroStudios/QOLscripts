#! /usr/bin/env python3

"""
This script is to scan in the background home directories and quarantine files that are marked as "Malware" By ClamAV
If a file is marked by ClamAV it will display a pop up letting the user know a file was a hit for malware and has been
Quarantined. An amazing feature would be to pull ClamAV codes so you can manually quarantine or restore from it via
another popup window.
"""

import subprocess
import re
import time

pattern = r'^/.*:'
matches = set()


try:
    clam_out = subprocess.check_output(['clamscan', '-ir', '--no-summary', '--log=/tmp/clamscan.log', '/home/test/'])
except subprocess.CalledProcessError:
    pass

with open('/tmp/clamscan.log', 'r') as log:
    for line in log.readlines():
        line = line.replace('\n', '')
        if re.search(string=line, pattern=pattern):
            line = re.search(string=line, pattern=pattern).group().replace(':', '')
            matches.add(line)
        else:
            pass

if len(matches) > 0:
    # Pops GUI up to figure out what we should do with those naughty files
    pass
else:
    time.sleep()